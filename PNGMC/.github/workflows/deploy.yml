name: Deploy to InfinityFree

on:
  push:
    branches:
      - main  # Change if your production branch is different

jobs:
  ftp-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: FTP Deploy to InfinityFree
        uses: SamKirkland/FTP-Deploy-Action@v4.3.6
        with:
          server: ${{ secrets.FTP_HOST }}          # e.g., ftpupload.net
          username: ${{ secrets.FTP_USERNAME }}    # FTP username
          password: ${{ secrets.FTP_PASSWORD }}    # FTP password
          port: 21
          local-dir: ./                             # Folder in repo to upload
          server-dir: /htdocs                       # Your InfinityFree root folder
          security: explicit                        # Forces Explicit FTPS (TLS)
          timeout: 180                              # Increase timeout for large uploads
          log-level: verbose                         # Useful for debugging
          dry-run: false                             # true = simulation
          dangerous-clean-slate: false               # Avoid accidental deletion

      - name: Retry FTP Deploy on Failure
        if: failure()                             # Only run if previous step failed
        uses: stefanzweifel/auto-ftp-retry-action@v1
        with:
          retries: 3                               # Number of retry attempts
          delay-seconds: 10                        # Wait time between retries
